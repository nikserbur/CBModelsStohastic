# 9.libraries.r — Единый файл подключения всех библиотек проекта
# Стохастическое моделирование процентных ставок ЦБ

#### Константы ####
`%!in%` <- Negate(`%in%`)

#### Список всех необходимых библиотек ####
libs <- c(
  # Основные библиотеки для работы с данными
  "data.table",        # Быстрая обработка данных
  "tidyverse",         # Коллекция для data science
  "magrittr",          # Pipe оператор %>%
  
  # Визуализация
  "plotly",            # Интерактивные графики
  
  # Статистика и моделирование
  "stats",             # Базовая статистика R
  "stats4",            # Дополнительные статистические функции
  "moments",           # Моменты распределений (kurtosis, skewness)
  "MASS",              # Статистические функции и распределения
  
  # Распределения и стохастические процессы
  "extraDistr",        # Дополнительные распределения
  "fitdistrplus",      # Подгонка распределений
  "stabledist",        # α-stable распределения
  "alphastable",       # Альтернативная библиотека для α-stable
  
  # Оценка качества моделей
  "scoringRules",      # CRPS, PIT и другие метрики
  
  # Работа с файлами
  "qs",                # Быстрое сохранение/загрузка данных
  "readxl",            # Чтение Excel файлов
  
  # Дополнительные библиотеки для расширенной функциональности
  "zoo",               # Временные ряды
  "forecast",          # Прогнозирование
  "lubridate",         # Работа с датами
  "httr"               # HTTP запросы и соединения
)

#### Автоматическая установка недостающих пакетов ####
cat("Проверка и установка необходимых библиотек...\n")

new.packages <- libs[!(libs %in% installed.packages()[,"Package"])]
if(length(new.packages)) {
  cat("Устанавливаем недостающие пакеты:", paste(new.packages, collapse = ", "), "\n")
  install.packages(new.packages, dependencies = TRUE)
} else {
  cat("Все необходимые пакеты уже установлены\n")
}

#### Подключение всех библиотек ####
cat("Подключение библиотек...\n")
purrr::walk(libs, ~{
  suppressPackageStartupMessages(library(.x, character.only = TRUE))
  cat("✓", .x, "\n")
})

cat("Все библиотеки успешно подключены!\n")

#### Дополнительные настройки ####
# Настройки для data.table
setDTthreads(0)  # Использовать все доступные ядра

# Настройки для plotly
options(plotly.browser = TRUE)  # Открывать графики в браузере

cat("Настройки завершены. Система готова к работе.\n")

